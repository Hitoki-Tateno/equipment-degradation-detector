# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ

**å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:** equipment-degradation-detectorï¼ˆè¨­å‚™åŠ£åŒ–æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼‰
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥:** 2026-02-20
**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯:** React 18.3.0 + FastAPI >= 0.115.0 + SQLite + scikit-learn

## ã‚µãƒãƒªãƒ¼

å…¨ä½“ã¨ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç´„900è¡Œã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç´„1,100è¡Œï¼‰ã«å¯¾ã—ã¦é©åˆ‡ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆãŒãªã•ã‚Œã¦ã„ã‚‹ã€‚ç‰¹ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® **ABCï¼ˆæŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰ã«ã‚ˆã‚‹å¥‘ç´„é§†å‹•è¨­è¨ˆ** ã¨ **ä¾å­˜ãƒ«ãƒ¼ãƒ«ã®è‡ªå‹•æ¤œè¨¼ãƒ†ã‚¹ãƒˆ** ã¯ã€ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã¯éå¸¸ã«å„ªã‚Œã¦ã„ã‚‹ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚‚ `useReducer` ã«ã‚ˆã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã¨APIå±¤ã®åˆ†é›¢ãŒé©åˆ‡ã«è¡Œã‚ã‚Œã¦ã„ã‚‹ã€‚ä¸»ãªæ”¹å–„ç‚¹ã¯ã€**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ä¸åœ¨**ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹æ¼æ´©ãƒªã‚¹ã‚¯ï¼‰ã€**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®Error Boundaryä¸åœ¨**ã€ãŠã‚ˆã³ **async defå†…ã§ã®åŒæœŸI/Oå®Ÿè¡Œ** ã®3ç‚¹ã«é›†ç´„ã•ã‚Œã‚‹ã€‚

---

## è©•ä¾¡

### 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨è²¬å‹™åˆ†é›¢

**è©•ä¾¡: ğŸŸ¢ è‰¯å¥½**

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæ˜ç¢ºã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚

```
backend/
  interfaces/    â† å…¨å±¤ã®å¥‘ç´„ï¼ˆDataStore, ResultStore, FeatureBuilderï¼‰
  store/         â† DataStoreInterface ã® SQLite å®Ÿè£…
  result_store/  â† ResultStoreInterface ã® SQLite å®Ÿè£…
  analysis/      â† AnalysisEngine + trend/anomaly/feature
  ingestion/     â† FastAPI ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆmain.py, 389è¡Œï¼‰
  dependencies.py â† DI ãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ + é…å»¶åˆæœŸåŒ–ï¼‰
```

- `backend/interfaces/` ã«å…¨ABCï¼ˆ`DataStoreInterface`, `ResultStoreInterface`, `FeatureBuilder`ï¼‰ãŒé›†ç´„ã•ã‚Œã¦ãŠã‚Šã€ä»–ã®å…¨å±¤ãŒã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã®ã¿ä¾å­˜ã™ã‚‹è¨­è¨ˆãŒå¾¹åº•ã•ã‚Œã¦ã„ã‚‹
- `backend/dependencies.py` ãŒã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚±ãƒ¼ã‚¿ã¨ã—ã¦æ©Ÿèƒ½ã—ã€`ingestion/` ã‹ã‚‰ `store/` ã¸ã®ç›´æ¥importã‚’é˜²æ­¢ã—ã¦ã„ã‚‹ï¼ˆ[dependencies.py:20](backend/dependencies.py#L20)ã€[dependencies.py:30](backend/dependencies.py#L30) ã§é…å»¶importï¼‰
- `AnalysisEngine`ï¼ˆ[engine.py:20-124](backend/analysis/engine.py#L20-L124)ï¼‰ã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦é©åˆ‡ã«è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€trend/anomaly/featureã®å„ãƒ­ã‚¸ãƒƒã‚¯ãŒç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹

**è‰¯ã„ç‚¹:**
- `FeatureBuilder` ãŒTemplate Methodãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ï¼ˆ[feature.py:19-36](backend/interfaces/feature.py#L19-L36)ï¼‰ã€‚`build()` ãŒ `_build_impl()` ã‚’å‘¼ã³å‡ºã—ã€å¾Œå‡¦ç†ï¼ˆ2Dé…åˆ—ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’è‡ªå‹•é©ç”¨
- Pydantic v2 ã® `@field_validator(mode="after")` ã‚’ä½¿ã£ãŸã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æ­£è¦åŒ–ãŒä¸€è²«ã—ã¦ã„ã‚‹ï¼ˆ[main.py:50-55](backend/ingestion/main.py#L50-L55)ã€[main.py:110-123](backend/ingestion/main.py#L110-L123)ï¼‰

**è»½å¾®ãªæŒ‡æ‘˜:**
- `backend/ingestion/main.py` ãŒ389è¡Œã§ã€13ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ + 9ã¤ã®Pydanticãƒ¢ãƒ‡ãƒ«ã‚’å«ã‚€ã€‚ç¾æ™‚ç‚¹ã§ã¯1ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†å¯èƒ½ãªè¦æ¨¡ã ãŒã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¢—ãˆã‚‹å ´åˆã¯ `APIRouter` ã«ã‚ˆã‚‹åˆ†å‰²ã‚’æ¤œè¨ã™ã‚‹ä¾¡å€¤ãŒã‚ã‚‹ï¼ˆå·¥æ•°: ä½ï¼‰

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

```
frontend/src/
  components/   â† 5ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆApp.js + 4 JSXï¼‰
  hooks/        â† 2ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
  services/     â† APIé€šä¿¡å±¤ï¼ˆapi.jsï¼‰
  utils/        â† ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆcategoryUtils.jsï¼‰
  mocks/        â† ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
```

- **APIå‘¼ã³å‡ºã—ãŒ `services/api.js` ã«å®Œå…¨é›†ç´„**ã•ã‚Œã¦ãŠã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ç›´æ¥axiosã‚’å‘¼ã‚“ã§ã„ã‚‹ç®‡æ‰€ã¯ãªã„
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒ `useBaselineManager` ãƒ•ãƒƒã‚¯ã«é›†ç´„**ï¼ˆ[useBaselineManager.js:165-301](frontend/src/hooks/useBaselineManager.js#L165-L301)ï¼‰ã€‚ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨­å®šã®CRUDã€åˆ†æçµæœå–å¾—ã€é™¤å¤–ç‚¹ç®¡ç†ã€ã‚¹ãƒ†ãƒ¼ãƒˆåŒæœŸãŒ1ç®‡æ‰€ã«é›†ã¾ã£ã¦ã„ã‚‹
- `React.memo()` ãŒå…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é©ç”¨ã•ã‚Œã¦ãŠã‚Šã€ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²æ­¢ã—ã¦ã„ã‚‹

**è»½å¾®ãªæŒ‡æ‘˜:**
- `Dashboard.jsx`ï¼ˆ209è¡Œï¼‰ã¯ãƒ‡ãƒ¼ã‚¿å–å¾— + ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º + æ“ä½œãƒãƒ³ãƒ‰ãƒ©ã‚’å«ã‚€ãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ã«å¯¾ã—ã¦åˆ†å‰²ã™ã‚‹ã»ã©ã®è¤‡é›‘ã•ã§ã¯ãªã„ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆ`useDashboardData`ç­‰ï¼‰ã¸ã®åˆ†é›¢ã¯å°†æ¥çš„ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¨˜éŒ²
- `WorkTimePlot.jsx`ï¼ˆ207è¡Œï¼‰ã¯Plotlyã®å‘½ä»¤çš„APIï¼ˆ`Plotly.restyle`ã€[WorkTimePlot.jsx:54](frontend/src/components/WorkTimePlot.jsx#L54)ï¼‰ã¨å®£è¨€çš„Reactã®æ··åœ¨ãŒä¸å¯é¿ã€‚Plotlyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆ¶ç´„ä¸Šã€ç¾åœ¨ã®å®Ÿè£…ã¯å¦¥å½“

---

### 2. ãƒ•ãƒ­ãƒ³ãƒˆâ‡”ãƒãƒƒã‚¯é–“ã®æ•´åˆæ€§

**è©•ä¾¡: ğŸŸ¡ æ”¹å–„æ¨å¥¨**

#### APIå‹ã®æ•´åˆæ€§

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ `services/api.js` ã®JSDocå‹å®šç¾©ï¼ˆ[api.js:5-45](frontend/src/services/api.js#L5-L45)ï¼‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®Pydanticãƒ¢ãƒ‡ãƒ«ï¼ˆ[main.py:43-133](backend/ingestion/main.py#L43-L133)ï¼‰ã¯ **æ‰‹å‹•ã§äºŒé‡ç®¡ç†** ã•ã‚Œã¦ã„ã‚‹ã€‚

| ãƒ•ãƒ­ãƒ³ãƒˆ (JSDoc)        | ãƒãƒƒã‚¯ (Pydantic)           | ä¸€è‡´ |
|-------------------------|-----------------------------|------|
| `CategoryNode`          | `CategoryNodeResponse`      | âœ…   |
| `WorkRecord`            | `RecordResponse`            | âœ…   |
| `TrendResult`           | `TrendResultResponse`       | âœ…   |
| `AnomalyResult`         | `AnomalyResultResponse`     | âœ…   |
| `BaselineConfig`        | `ModelDefinitionRequest/Response` | âœ…   |

ç¾æ™‚ç‚¹ã§ã¯å‹ã®ä¹–é›¢ã¯ãªã„ãŒã€**OpenAPIã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ã®è‡ªå‹•ç”Ÿæˆï¼ˆopenapi-typescriptç­‰ï¼‰ã‚’å°å…¥ã—ã¦ã„ãªã„** ãŸã‚ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒè¿½å¾“ã—å¿˜ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã€‚ãŸã ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ï¼ˆ7 APIé–¢æ•°ï¼‰ã‚’è€ƒæ…®ã™ã‚‹ã¨ã€è‡ªå‹•ç”Ÿæˆã®å°å…¥ã‚³ã‚¹ãƒˆå¯¾åŠ¹æœã¯ç¾æ™‚ç‚¹ã§ã¯ä½ã„ã€‚

#### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ•´åˆæ€§

- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ `HTTPException` ã§ `400`/`404` ã‚’è¿”ã—ã¦ã„ã‚‹ï¼ˆ[main.py:196-198](backend/ingestion/main.py#L196-L198)ã€[main.py:304-306](backend/ingestion/main.py#L304-L306)ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® `useBaselineManager.js` ã¯404ã‚’æ­£ã—ãåŒºåˆ¥ã—ã¦å‡¦ç†ã—ã¦ã„ã‚‹ï¼ˆ[useBaselineManager.js:205-209](frontend/src/hooks/useBaselineManager.js#L205-L209)ï¼‰
- `Dashboard.jsx` ã¯ `Promise.allSettled()` ã‚’ä½¿ã„ã€1ã‚«ãƒ†ã‚´ãƒªã®å–å¾—å¤±æ•—ãŒä»–ã«æ³¢åŠã—ãªã„è¨­è¨ˆï¼ˆ[Dashboard.jsx:37-40](frontend/src/components/Dashboard.jsx#L37-L40)ï¼‰

#### async/sync ã®æ•´åˆæ€§ã«é–¢ã™ã‚‹æ‡¸å¿µ

**æŒ‡æ‘˜äº‹é …:**
å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ `async def` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€Storeå±¤ã®SQLiteæ“ä½œï¼ˆ`sqlite3`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã¯ **åŒæœŸI/O** ã§ã‚ã‚‹ã€‚FastAPIã§ã¯ `async def` å†…ã®åŒæœŸI/Oã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã€‚

- [main.py:159](backend/ingestion/main.py#L159): `async def post_records()` â†’ `store.upsert_records()` (åŒæœŸ)
- [main.py:240](backend/ingestion/main.py#L240): `async def get_records()` â†’ `store.get_records()` (åŒæœŸ)
- [engine.py:39-101](backend/analysis/engine.py#L39-L101): `AnalysisEngine.run()` ã¯ IsolationForest ã® `fit()`/`score_samples()` ã‚’å«ã‚€åŒæœŸå‡¦ç†

FastAPIã§ã¯åŒæœŸå‡¦ç†ã‚’å«ã‚€å ´åˆã€`async def` ã§ã¯ãªã `def` ã§å®šç¾©ã™ã‚‹ã¨ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã§å®Ÿè¡Œã•ã‚Œãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã‚’å›é¿ã§ãã‚‹ã€‚ãŸã ã—ã€ç¾æ™‚ç‚¹ã§ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒ¬ãƒ—ãƒªã‚«æ§‹æˆï¼ˆ[deployment.yaml](k8s/deployment.yaml): `replicas: 1`ï¼‰ã‹ã¤åŒæ™‚æ¥ç¶šæ•°ãŒé™å®šçš„ãªãŸã‚ã€å®Ÿé‹ç”¨ä¸Šã®å•é¡Œã¯ç™ºç”Ÿã—ã«ãã„ã€‚

#### CORSè¨­å®š

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã« `CORSMiddleware` ã¯è¨­å®šã•ã‚Œã¦ã„ãªã„ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯nginxãŒãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦ `/api/` ã‚’å†…éƒ¨è»¢é€ã™ã‚‹ãŸã‚å•é¡Œãªã„ãŒã€é–‹ç™ºç’°å¢ƒã§ã¯ `package.json` ã® `"proxy": "http://localhost:8000"` ã«ä¾å­˜ã—ã¦ã„ã‚‹ã€‚å°†æ¥çš„ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’CRAä»¥å¤–ã®ãƒ„ãƒ¼ãƒ«ã«ç§»è¡Œã™ã‚‹å ´åˆã€CORSè¨­å®šã®è¿½åŠ ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

---

### 3. ä¾å­˜é–¢ä¿‚ã®å¥å…¨æ€§

**è©•ä¾¡: ğŸŸ¢ è‰¯å¥½**

#### å¾ªç’°ä¾å­˜

å¾ªç’°ä¾å­˜ã¯å­˜åœ¨ã—ãªã„ã€‚ä¾å­˜ã‚°ãƒ©ãƒ•ã¯ä»¥ä¸‹ã®é€šã‚Šä¸€æ–¹å‘ï¼š

```
ingestion/main.py
  â†’ backend.dependencies (DI factory)
  â†’ backend.interfaces.* (ABC)
  â†’ backend.analysis.engine (AnalysisEngine)

backend.dependencies
  â†’ backend.store.sqlite (lazy import)
  â†’ backend.result_store.sqlite (lazy import)
  â†’ backend.analysis.engine

backend.analysis.engine
  â†’ backend.interfaces.* (ABC)
  â†’ backend.analysis.anomaly / trend / feature

backend.store.sqlite
  â†’ backend.interfaces.data_store (ABC)

backend.result_store.sqlite
  â†’ backend.interfaces.result_store (ABC)
```

#### ä¾å­˜ãƒ«ãƒ¼ãƒ«ã®è‡ªå‹•æ¤œè¨¼

`tests/unit/test_dependency_rules.py` ãŒASTè§£æã«ã‚ˆã‚Š `analysis/` ã¨ `ingestion/` ã‹ã‚‰ `backend.store` / `backend.result_store` ã¸ã®ç›´æ¥importã‚’ **è‡ªå‹•æ¤œå‡º** ã™ã‚‹ï¼ˆ57è¡Œï¼‰ã€‚ã“ã‚Œã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŠ£åŒ–ã‚’é˜²ãå„ªã‚ŒãŸä»•çµ„ã¿ã€‚

#### ä¾å­˜ã®æ–¹å‘æ€§

Clean Architectureçš„ãªè¦³ç‚¹ã§ã€ä¾å­˜ã¯æ­£ã—ã **å†…å´ï¼ˆinterfacesï¼‰ã«å‘ã„ã¦ã„ã‚‹**ï¼š
- `store/sqlite.py` â†’ `interfaces/data_store.py` âœ…
- `result_store/sqlite.py` â†’ `interfaces/result_store.py` âœ…
- `analysis/engine.py` â†’ `interfaces/*` âœ…
- `ingestion/main.py` â†’ `interfaces/*` + `dependencies.py` âœ…

#### ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«

- `uv.lock` ãŒå­˜åœ¨ã—ã€Pythonä¾å­˜ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ âœ…
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® `package-lock.json` ã¯gitignoreã•ã‚Œã¦ã„ã‚‹æ¨¡æ§˜ï¼ˆCRAæ¨™æº–æ§‹æˆï¼‰ã€‚`npm ci` ã§ã¯ãªã `npm install` ãŒä½¿ã‚ã‚Œã‚‹ãŸã‚ã€ãƒ“ãƒ«ãƒ‰ã®å†ç¾æ€§ãŒã‚„ã‚„ä½ã„

**è»½å¾®ãªæŒ‡æ‘˜:**
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`package-lock.json`ï¼‰ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«å«ã‚ã‚‹ã“ã¨ã§ã€ãƒ“ãƒ«ãƒ‰å†ç¾æ€§ãŒå‘ä¸Šã™ã‚‹

---

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

**è©•ä¾¡: ğŸŸ¡ æ”¹å–„æ¨å¥¨**

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

**å•é¡Œ: ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãŒæœªå®šç¾©**

`backend/ingestion/main.py` ã«ã¯ `@app.exception_handler()` ãŒ1ä»¶ã‚‚å®šç¾©ã•ã‚Œã¦ã„ãªã„ã€‚FastAPIã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã§ã¯ã€æœªæ•æ‰ã®ä¾‹å¤–ã¯ `500 Internal Server Error` ã¨ã—ã¦ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å«ã‚€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

å…·ä½“çš„ãªãƒªã‚¹ã‚¯ç®‡æ‰€:
- [main.py:179-180](backend/ingestion/main.py#L179-L180): `engine.run(cid)` â€” IsolationForestã® `fit()` ãŒå°‘æ•°ãƒ‡ãƒ¼ã‚¿ã§å¤±æ•—ã—ãŸå ´åˆã€ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¼æ´©
- [main.py:233-234](backend/ingestion/main.py#L233-L234): CSVå–ã‚Šè¾¼ã¿å¾Œã® `engine.run(cid)` â€” åŒä¸Š
- [engine.py:91](backend/analysis/engine.py#L91): `train_and_score()` â€” scikit-learnã®å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒæœªæ•æ‰

**æ¨å¥¨å¯¾å¿œ:**
```python
@app.exception_handler(Exception)
async def unhandled_exception_handler(request, exc):
    # ãƒ­ã‚°ã«è©³ç´°ã‚’è¨˜éŒ²ã—ã¤ã¤ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã¯æ±ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¿”ã™
    return JSONResponse(status_code=500, content={"detail": "Internal server error"})
```

**å•é¡Œ: `response_model` æœªæŒ‡å®š**

å…¨13ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ `response_model` ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã€‚ã“ã‚Œã«ã‚ˆã‚ŠOpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒãŒä¸å®Œå…¨ã«ãªã‚Šã€ã¾ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æ„å›³ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã€‚

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

**å•é¡Œ: Error BoundaryãŒæœªå®Ÿè£…**

Reactã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä¸­ã«ç™ºç”Ÿã™ã‚‹ä¾‹å¤–ï¼ˆ`useMemo` å†…ã®nullã‚¢ã‚¯ã‚»ã‚¹ç­‰ï¼‰ã‚’æ•æ‰ã™ã‚‹ `ErrorBoundary` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„ã€‚Plotlyã®å†…éƒ¨ã‚¨ãƒ©ãƒ¼ã‚„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ä¸æ•´åˆã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**è‰¯ã„ç‚¹:**
- `useBaselineManager.js` ã§ `cancelled` ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆå¾Œã®stateæ›´æ–°é˜²æ­¢ï¼ˆ[useBaselineManager.js:174](frontend/src/hooks/useBaselineManager.js#L174)ã€[useBaselineManager.js:217](frontend/src/hooks/useBaselineManager.js#L217)ï¼‰
- `Dashboard.jsx` ã® `Promise.allSettled()` ã«ã‚ˆã‚‹éƒ¨åˆ†çš„å¤±æ•—ã®è¨±å®¹ï¼ˆ[Dashboard.jsx:37](frontend/src/components/Dashboard.jsx#L37)ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ—¥æœ¬èªã§çµ±ä¸€ã•ã‚Œã¦ãŠã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦åˆ†ã‹ã‚Šã‚„ã™ã„

---

### 5. ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£

**è©•ä¾¡: ğŸŸ¢ è‰¯å¥½**

#### ãƒ†ã‚¹ãƒˆæ§‹æˆ

67ãƒ†ã‚¹ãƒˆé–¢æ•° / 22ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ / 7ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«:

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | ã‚«ãƒãƒ¼ç¯„å›² |
|---------|---------|-----------|
| `test_dependency_rules.py` | 1 | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ¶ç´„ |
| `test_data_store_contract.py` | 12 | DataStoreInterfaceå¥‘ç´„ |
| `test_result_store_contract.py` | 14 | ResultStoreInterfaceå¥‘ç´„ |
| `test_analysis_engine.py` | 20 | AnalysisEngine + trend/feature |
| `test_anomaly.py` | 5 | IsolationForest |
| `test_analysis_flow.py` | 15 | E2E APIãƒ•ãƒ­ãƒ¼ |

#### è¨­è¨ˆä¸Šã®è‰¯ã„ç‚¹

- **DI ã«ã‚ˆã‚‹ãƒ¢ãƒƒã‚¯å·®ã—æ›¿ãˆ**: `AnalysisEngine` ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ã§ `DataStoreInterface` / `ResultStoreInterface` ã‚’å—ã‘å–ã‚‹ãŸã‚ã€`MagicMock(spec=DataStoreInterface)` ã§ãƒ†ã‚¹ãƒˆå¯èƒ½
- **`_reset_all()`**: [dependencies.py:44-49](backend/dependencies.py#L44-L49) ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒªã‚»ãƒƒãƒˆé–¢æ•°ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆé–“ã®çŠ¶æ…‹æ±šæŸ“ã‚’é˜²æ­¢
- **å¥‘ç´„ãƒ†ã‚¹ãƒˆ**: ABCå®Ÿè£…ãŒå¥‘ç´„ã‚’æº€ãŸã™ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆã§ä¿è¨¼ã€‚æ–°ã—ã„ Store å®Ÿè£…ï¼ˆä¾‹: PostgreSQLï¼‰ã‚’è¿½åŠ ã—ã¦ã‚‚ã€åŒã˜ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§æ¤œè¨¼å¯èƒ½
- **`tmp_path` ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**: å…¨ãƒ†ã‚¹ãƒˆãŒä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®SQLiteã‚’ä½¿ç”¨ã—ã€ãƒ†ã‚¹ãƒˆé–“ã®å¹²æ¸‰ãªã—
- **æ±ºå®šè«–çš„MLãƒ†ã‚¹ãƒˆ**: `random_state=42` ã«ã‚ˆã‚Š IsolationForest ã®çµæœãŒå†ç¾å¯èƒ½

#### æ”¹å–„å€™è£œ

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆãŒä¸åœ¨**: `react-scripts test` ã‚³ãƒãƒ³ãƒ‰ã¯å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ã€‚`useBaselineManager` ã®reduceré–¢æ•°ï¼ˆ[useBaselineManager.js:54-157](frontend/src/hooks/useBaselineManager.js#L54-L157)ï¼‰ã¯ç´”ç²‹é–¢æ•°ã¨ã—ã¦ `export` ã•ã‚Œã¦ãŠã‚Šã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¯é«˜ã„
- **ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ãŒ0%**: [pyproject.toml](pyproject.toml) ã® `fail_under = 0` ã¯é–‹ç™ºåˆæœŸã«ã¯é©åˆ‡ã ãŒã€å®‰å®šåŒ–ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯å¼•ãä¸Šã’ã‚’æ¤œè¨

---

## å„ªå…ˆå¯¾å¿œäº‹é …

| å„ªå…ˆåº¦ | å•é¡Œ | å½±éŸ¿ | æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|------|------|----------------|
| **P0** | ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ä¸åœ¨ | æœªæ•æ‰ä¾‹å¤–ã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¼æ´©ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ | `@app.exception_handler(Exception)` ã‚’è¿½åŠ ã—ã€500ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰è©³ç´°ã‚’é™¤å¤–ã™ã‚‹ã€‚å·¥æ•°: 10è¡Œç¨‹åº¦ |
| **P1** | Error Boundaryæœªå®Ÿè£… | Plotlyãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ç­‰ã§ã‚¢ãƒ—ãƒªå…¨ä½“ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã†ã‚‹ | `ErrorBoundary` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã—ã€PlotView/Dashboardå˜ä½ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã€‚å·¥æ•°: 30è¡Œç¨‹åº¦ |
| **P2** | `async def` å†…ã®åŒæœŸI/O | ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã«ã‚ˆã‚ŠåŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†æ€§èƒ½ãŒä½ä¸‹ã—ã†ã‚‹ï¼ˆç¾æ§‹æˆã§ã¯å½±éŸ¿è»½å¾®ï¼‰ | Storeå±¤ã®åŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ `def`ï¼ˆéasyncï¼‰ã«å¤‰æ›´ã™ã‚‹ã‹ã€`run_in_executor` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã€‚å·¥æ•°: ä¸­ï¼ˆå…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¦‹ç›´ã—ï¼‰ |
